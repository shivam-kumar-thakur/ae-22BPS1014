import{r as o,u as B,j as e}from"./index-DeJVmANz.js";/* empty css                 *//* empty css                 *//* empty css                         *//* empty css                      *//* empty css                         */import{b as v,g as b,c as _,w as N}from"./prefilled-data-Cf8CPL9T.js";import{f as x}from"./apiFetching-D9uxTKnH.js";function W(){const[U,w]=o.useState({username:"",phone_number:"",blood_group:"",gender:"",dob:"",last_donated_date:"",prefered_donation:"",country:"",pincode:""}),[n,j]=o.useState({username:"",phone_number:"",blood_group:"",gender:"",dob:"",last_donated_date:"",prefered_donation:"",country:"",pincode:""}),[c,y]=o.useState({currentPassword:"",newPassword:""}),[s,P]=o.useState({}),[l,D]=o.useState({}),[g,E]=o.useState({}),[u,p]=o.useState(null),m=B(),[h,S]=o.useState({currentName:"",currentEmail:""});o.useEffect(()=>{x("GET","api/v1/general/user").then(t=>{if(!t)localStorage.setItem("userLogged",!1),m("/login");else{const d={username:t.data.name,phone_number:t.data.mobile_number,blood_group:t.data.blood_group,gender:t.data.gender,dob:t.data.dob?t.data.dob.split("T")[0]:"",last_donated_date:t.data.last_donated_date?t.data.last_donated_date.split("T")[0]:"",prefered_donation:t.data.can_donate,country:t.data.country,pincode:t.data.pincode},i={total_share:t.data.total_share,blood_donated:t.data.donated_blood.length};w(d),j(d),E(i),S(()=>({currentName:t.data.name,currentEmail:t.data.email})),t.data.gender==="MALE"?p(()=>"image/male.webp"):t.data.gender==="FEMALE"?p(()=>"image/female.webp"):p(()=>"image/other.webp")}}).catch(t=>{console.error(t),localStorage.setItem("userLogged",!1),m("/login")});const a=new Date().toISOString().split("T")[0];document.getElementById("last_donated_date").setAttribute("max",a),document.getElementById("dob").setAttribute("max",a)},[m]);function r(a){const{name:t,value:d}=a.target;j(i=>({...i,[t]:d}))}const C=()=>{const a={};if(Object.keys(n).forEach(t=>{t!=="last_donated_date"&&(n[t].trim()===""&&(a[t]="It is a required field"),n[t]==="info"&&(a[t]="Choose an option"))}),Object.keys(a).length!==0){P(a);return}else O()},f=a=>{const{name:t,value:d}=a.target;y(i=>({...i,[t]:d}))},q=()=>{const a={};if(Object.keys(c).forEach(t=>{c[t].trim()===""&&(a[t]="It is a required field")}),Object.keys(a).length!==0){D(a);return}else I()},O=()=>{x("POST","api/v1/general/profile-update",n).then(a=>{alert(a?"Data updated successfully.":"Something went wrong")}).catch(a=>{console.error(a),alert("Something went wrong in updating data. Please try again later.")})},I=()=>{x("POST","api/v1/general/change-password",c).then(a=>{alert(a?"Password updated successfully.":"Enter correct password")}).catch(a=>{console.error(a),alert("Something went wrong in updating Password. Please try again later.")})};return e.jsxs("div",{className:"my-profile-main-container",children:[e.jsx("h2",{className:"donor-heading",children:"Update Details"}),e.jsx("p",{className:"description-donor-details",children:"View and update your details. These details will help us to reach you."}),e.jsxs("div",{className:"first-area",children:[e.jsxs("div",{className:"input-area-container",children:[e.jsxs("div",{className:"my-icon card",children:[e.jsxs("div",{className:"general-info",children:[!u&&e.jsx("h3",{children:"Fetching details..."}),u&&h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"outer-container-my-icon",children:e.jsx("img",{src:u,className:"my-icon-img",alt:"profile-pic"})}),e.jsxs("div",{children:[e.jsx("p",{className:"name-profile",children:h.currentName}),e.jsx("p",{className:"gmail-profile",children:h.currentEmail})]})]})]}),e.jsxs("div",{className:"contribution-details",children:[e.jsxs("div",{className:"profile-count-total",children:[e.jsx("div",{className:"profile-circle1",children:e.jsx("div",{className:"profile-circle2",children:e.jsx("p",{className:"profile-total-count",children:g.blood_donated})})}),e.jsx("p",{className:"profile-count-type",children:"Blood Donated"})]}),e.jsxs("div",{className:"profile-count-total",children:[e.jsx("div",{className:"profile-circle1",children:e.jsx("div",{className:"profile-circle2",children:e.jsx("p",{className:"profile-total-count",children:g.total_share})})}),e.jsx("p",{className:"profile-count-type",children:"Â Referral Used"})]})]})]}),e.jsxs("div",{className:"submit-container-input card",children:[e.jsxs("div",{className:"input-submit-container",children:[e.jsx("h3",{className:"input-submit-container-h3",children:"Reset Password"}),e.jsx("input",{type:"password",id:"old_pass",name:"currentPassword",placeholder:"Current Password",onChange:f,required:!0}),l.currentPassword&&e.jsx("p",{className:"invalid-data invalid-donor-form-data",children:l.old_pass}),e.jsx("input",{type:"password",id:"new_pass",name:"newPassword",placeholder:"New Password",onChange:f,required:!0}),l.newPassword&&e.jsx("p",{className:"invalid-data invalid-donor-form-data",children:l.new_pass})]}),e.jsx("div",{className:"submit-container",children:e.jsx("button",{className:"button-2",onClick:()=>q(),children:"Update"})})]})]}),e.jsxs("div",{className:"input-area-container card",children:[e.jsx("h3",{className:"input-submit-container-h3",children:"Update Details"}),e.jsxs("form",{className:"form-data",children:[e.jsx("input",{type:"text",id:"username",name:"username",placeholder:"Username",value:n.username||"",onChange:r,required:!0}),s.username&&e.jsx("p",{className:"invalid-data invalid-donor-form-data",children:s.username}),e.jsx("input",{type:"tel",id:"phone_number",name:"phone_number",placeholder:"Phone Number",value:n.phone_number||"",onChange:r,required:!0}),s.phone_number&&e.jsx("p",{className:"invalid-data invalid-donor-form-data",children:s.phone_number}),e.jsx("p",{className:"dob-text",children:"Date of Birth"}),e.jsx("input",{type:"date",id:"dob",name:"dob",value:n.dob||"",onChange:r,required:!0}),s.dob&&e.jsx("p",{className:"invalid-data invalid-donor-form-data",children:"Enter Birth Date."}),e.jsxs("div",{className:"two-input-div-profile",children:[e.jsxs("select",{name:"blood_group",id:"blood_group",value:n.blood_group||"",onChange:r,required:!0,children:[e.jsx("option",{value:"",children:"Blood Group"}),Object.keys(v).map(a=>e.jsx("option",{value:v[a],children:a},a))]}),e.jsxs("select",{name:"gender",id:"gender",value:n.gender||"",onChange:r,required:!0,children:[e.jsx("option",{value:"",children:"Gender"}),Object.keys(b).map(a=>e.jsx("option",{value:b[a],children:a},a))]})]}),s.blood_group&&e.jsx("p",{className:"invalid-data invalid-donor-form-data",children:"Select Blood Group."}),s.gender&&e.jsx("p",{className:"invalid-data invalid-donor-form-data",children:"Select Gender."}),e.jsxs("div",{className:"two-input-div-profile",children:[e.jsxs("select",{name:"country",id:"country",value:n.country||"",onChange:r,required:!0,children:[e.jsx("option",{value:"",children:"Country"}),Object.keys(_).map(a=>e.jsx("option",{value:_[a],children:a},a))]}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",placeholder:"Pincode",value:n.pincode||"",onChange:r,required:!0})]}),s.country&&e.jsx("p",{className:"invalid-data invalid-donor-form-data",children:"Select Country."}),s.pincode&&e.jsx("p",{className:"invalid-data invalid-donor-form-data",children:"Enter Pincode."}),e.jsx("p",{className:"dob-text",children:"Last Donated Date"}),e.jsx("input",{type:"date",id:"last_donated_date",name:"last_donated_date",value:n.last_donated_date||"",onChange:r}),e.jsx("p",{className:"dob-text",children:"Whom You Can Donate?"}),e.jsxs("select",{name:"prefered_donation",id:"prefered_donation",value:n.prefered_donation||"",onChange:r,required:!0,children:[e.jsx("option",{value:"",children:"I can donate to..."}),Object.keys(N).map(a=>e.jsx("option",{value:N[a],children:a},a))]}),s.prefered_donation&&e.jsx("p",{className:"invalid-data invalid-donor-form-data",children:"Select Preference."})]}),e.jsx("div",{className:"submit-container",children:e.jsx("button",{className:"button-1",onClick:C,children:"Update"})})]})]})]})}export{W as default};
